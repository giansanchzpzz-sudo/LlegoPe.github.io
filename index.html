// script.js - Versión segura para GitHub Pages
document.addEventListener('DOMContentLoaded', function() {
    console.log('LlegoPe - Inicializando aplicación...');
    
    // 1. Animaciones de entrada básicas
    const fadeElements = document.querySelectorAll('.fadein-up');
    fadeElements.forEach((el, i) => {
        setTimeout(() => {
            if (el && el.classList) {
                el.classList.add('visible');
            }
        }, 120 + i * 120);
    });

    // 2. Estadísticas simples (sin Intersection Observer)
    setupSimpleStatistics();
    
    // 3. Carrusel básico
    setupSimpleTestimonials();
    
    // 4. Smooth scroll solo si los elementos existen
    setupSafeSmoothScroll();
    
    console.log('LlegoPe - Aplicación inicializada correctamente');
});

function setupSimpleStatistics() {
    const statNumbers = document.querySelectorAll('.stat-number');
    
    // Animación simple después de un delay
    setTimeout(() => {
        statNumbers.forEach((numberEl, index) => {
            if (numberEl) {
                const target = parseInt(numberEl.getAttribute('data-valor'), 10);
                if (!isNaN(target)) {
                    // Pequeño delay escalonado
                    setTimeout(() => {
                        animateSimpleCounter(numberEl, target, 1500);
                    }, index * 400);
                }
            }
        });
    }, 1000);
}

function animateSimpleCounter(element, target, duration = 1500) {
    if (!element) return;
    
    let current = 0;
    const steps = 60; // Número de pasos
    const increment = target / steps;
    const stepTime = duration / steps;
    const isLarge = target > 10000;
    
    let step = 0;
    const timer = setInterval(() => {
        current += increment;
        step++;
        
        if (step >= steps) {
            current = target;
            clearInterval(timer);
        }
        
        element.textContent = isLarge ? 
            Math.floor(current).toLocaleString('es-PE') : 
            Math.floor(current);
    }, stepTime);
}

function setupSimpleTestimonials() {
    const testimonios = document.querySelectorAll('.testimonio');
    
    // Solo si hay más de un testimonio
    if (!testimonios || testimonios.length <= 1) {
        console.log('Solo hay un testimonio o ninguno');
        return;
    }
    
    let currentIndex = 0;
    
    // Función para mostrar testimonio
    function showTestimonio(index) {
        testimonios.forEach((t, i) => {
            if (t.style) {
                t.style.display = i === index ? 'block' : 'none';
            }
        });
    }
    
    // Inicializar mostrando el primero
    showTestimonio(currentIndex);
    
    // Cambiar cada 5 segundos
    setInterval(() => {
        currentIndex = (currentIndex + 1) % testimonios.length;
        showTestimonio(currentIndex);
    }, 5000);
}

function setupSafeSmoothScroll() {
    const navLinks = document.querySelectorAll('a[href^="#"]');
    
    navLinks.forEach(anchor => {
        if (anchor) {
            anchor.addEventListener('click', function (e) {
                const targetId = this.getAttribute('href');
                
                // Solo procesar enlaces internos que no sean # solo
                if (targetId && targetId !== '#' && targetId.startsWith('#')) {
                    e.preventDefault();
                    
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        // Scroll suave nativo
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                }
                // Los enlaces externos (redes sociales) se manejan normalmente
            });
        }
    });
}

// Manejo de errores mejorado
function handleImageErrors() {
    document.querySelectorAll('img').forEach(img => {
        if (img) {
            img.addEventListener('error', function() {
                console.warn('Error cargando imagen:', this.src);
                // No ocultar la imagen, solo mostrar advertencia
            });
            
            img.addEventListener('load', function() {
                console.log('Imagen cargada correctamente:', this.src);
            });
        }
    });
}

// Llamar al manejo de errores
handleImageErrors();
