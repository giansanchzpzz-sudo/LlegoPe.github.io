// script.js - Versión optimizada para GitHub Pages
document.addEventListener('DOMContentLoaded', function() {
    initApp();
});

function initApp() {
    // 1. Animaciones de entrada
    const fadeElements = document.querySelectorAll('.fadein-up');
    fadeElements.forEach((el, i) => {
        setTimeout(() => el.classList.add('visible'), 120 + i * 120);
    });

    // 2. Estadísticas con Intersection Observer
    setupStatistics();
    
    // 3. Carrusel de testimonios
    setupTestimonials();
    
    // 4. Smooth scroll para navegación
    setupSmoothScroll();
}

function setupStatistics() {
    const statNumbers = document.querySelectorAll('.stat-number');
    
    // Usar Intersection Observer para animar cuando son visibles
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const numberEl = entry.target;
                const target = parseInt(numberEl.getAttribute('data-valor'), 10);
                
                if (!isNaN(target)) {
                    animateCounter(numberEl, target, 2000);
                }
                observer.unobserve(numberEl);
            }
        });
    }, { threshold: 0.5 });
    
    statNumbers.forEach(number => observer.observe(number));
}

function animateCounter(element, target, duration = 2000) {
    let current = 0;
    const increment = target / (duration / 60); // 60fps
    const isLarge = target > 10000;
    
    function update() {
        current += increment;
        if (current >= target) {
            element.textContent = isLarge ? target.toLocaleString('es-PE') : target;
            return;
        }
        
        element.textContent = isLarge ? 
            Math.floor(current).toLocaleString('es-PE') : 
            Math.floor(current);
        
        requestAnimationFrame(update);
    }
    update();
}

function setupTestimonials() {
    const testimonios = document.querySelectorAll('.testimonio');
    if (testimonios.length <= 1) return;
    
    let currentIndex = 0;
    let intervalId;
    
    function showTestimonio(index) {
        testimonios.forEach(t => t.style.display = 'none');
        testimonios[index].style.display = 'block';
    }
    
    function startCarousel() {
        intervalId = setInterval(() => {
            currentIndex = (currentIndex + 1) % testimonios.length;
            showTestimonio(currentIndex);
        }, 5000);
    }
    
    function stopCarousel() {
        clearInterval(intervalId);
    }
    
    // Iniciar carrusel
    showTestimonio(currentIndex);
    startCarousel();
    
    // Pausar al interactuar
    const carrusel = document.querySelector('.testimonios-carrusel');
    if (carrusel) {
        carrusel.addEventListener('mouseenter', stopCarousel);
        carrusel.addEventListener('mouseleave', startCarousel);
    }
}

function setupSmoothScroll() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            
            const targetId = this.getAttribute('href');
            if (targetId === '#') return;
            
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
}

// Manejo de errores para imágenes (útil para GitHub Pages)
function handleImageErrors() {
    document.querySelectorAll('img').forEach(img => {
        img.addEventListener('error', function() {
            console.warn('Error loading image:', this.src);
            this.style.display = 'none';
        });
    });
}

// Llamar al manejo de errores de imágenes
handleImageErrors();
