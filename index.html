document.addEventListener('DOMContentLoaded', function() {
    // 1. Animación de aparición de elementos
    animateFadeIn();
    
    // 2. Configurar estadísticas
    setupStatistics();
    
    // 3. Configurar carrusel de testimonios
    setupTestimonials();
    
    // 4. Smooth scroll para navegación interna
    setupSmoothScroll();
    
    // 5. Tracking para redes sociales (opcional)
    setupSocialMediaTracking();
});

function animateFadeIn() {
    const elementsToFade = document.querySelectorAll('.fadein-up');
    elementsToFade.forEach(function(element, index) {
        setTimeout(() => {
            element.classList.add('visible');
        }, 120 + index * 120);
    });
}

function animateCounter(element, target, duration = 2000) {
    let start = 0;
    const isLarge = target > 10000;
    const increment = target / (duration / 16);
    let current = 0;
    
    function update() {
        current += increment;
        if (current > target) current = target;
        
        element.textContent = isLarge ? 
            Math.floor(current).toLocaleString('es-PE') : 
            Math.floor(current);
            
        if (current < target) {
            requestAnimationFrame(update);
        }
    }
    update();
}

function setupStatistics() {
    const statCards = document.querySelectorAll('.stat-card');
    const observerOptions = {
        threshold: 0.5,
        rootMargin: '0px 0px -100px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const numberElement = entry.target.querySelector('.stat-number');
                const targetValue = parseInt(numberElement.getAttribute('data-valor'), 10);
                
                if (!isNaN(targetValue)) {
                    animateCounter(numberElement, targetValue, 1800);
                }
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);
    
    statCards.forEach(card => {
        observer.observe(card);
    });
}

function setupTestimonials() {
    const carousel = document.querySelector('.testimonios-carrusel');
    const testimonials = document.querySelectorAll('.testimonio');
    
    if (!carousel || testimonials.length < 2) return;
    
    let currentIndex = 0;
    let carouselInterval;
    
    function showTestimonial(index) {
        testimonials.forEach(testimonial => {
            testimonial.style.display = 'none';
        });
        
        if (testimonials[index]) {
            testimonials[index].style.display = 'block';
        }
    }
    
    function nextTestimonial() {
        currentIndex = (currentIndex + 1) % testimonials.length;
        showTestimonial(currentIndex);
    }
    
    function startCarousel() {
        carouselInterval = setInterval(nextTestimonial, 5000);
    }
    
    function stopCarousel() {
        clearInterval(carouselInterval);
    }
    
    // Inicializar
    showTestimonial(currentIndex);
    startCarousel();
    
    // Pausar al interactuar
    carousel.addEventListener('mouseenter', stopCarousel);
    carousel.addEventListener('mouseleave', startCarousel);
    carousel.addEventListener('touchstart', stopCarousel);
    carousel.addEventListener('touchend', startCarousel);
}

function setupSmoothScroll() {
    const navLinks = document.querySelectorAll('a[href^="#"]');
    
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            const href = this.getAttribute('href');
            
            // Solo aplicar a enlaces internos que no sean redes sociales
            if (href.startsWith('#') && href !== '#' && !this.parentElement.classList.contains('rrss')) {
                e.preventDefault();
                
                const targetElement = document.querySelector(href);
                if (targetElement) {
                    const offsetTop = targetElement.offsetTop - 80;
                    
                    window.scrollTo({
                        top: offsetTop,
                        behavior: 'smooth'
                    });
                    
                    // Actualizar URL sin recargar
                    history.pushState(null, null, href);
                }
            }
        });
    });
}

function setupSocialMediaTracking() {
    const socialLinks = document.querySelectorAll('.rrss a');
    
    socialLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            // Los enlaces ya tienen target="_blank", así que se abren normalmente
            console.log('Red social clickeada:', this.href);
            
            // Aquí puedes agregar tu código de analytics
            // Ejemplo para Google Analytics 4:
            /*
            gtag('event', 'click', {
                'event_category': 'Social Media',
                'event_label': this.href,
                'transport_type': 'beacon'
            });
            */
        });
    });
}
